<!DOCTYPE html>	
<html>
<head>
	<meta charset="utf-8">
	<title>Tanks</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="../game-main.css">
	<link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,700|Source+Code+Pro:400,700&amp;subset=cyrillic" rel="stylesheet">
</head>
<body>
	<div id="game">
		<div id="field">
			<canvas></canvas>
			<div id="control">
				
			</div>
		</div>
	</div>
	<div id="workspace">
		<div id="resizer"></div>
		<div id='tabs'>
			<div style='position:absolute;top:1em;right:0.25em;opacity:0.3;z-index:0;font-size:75%'><b>Alt</b>+<b>-</b>, <b>Alt</b>+<b>+</b> (зум в редакторе)</div>
			<div class='tab' id="tab-code">Код</div><div class='tab active' id="tab-docs">Документация</div><div class='tab' id="tab-scoreboard">Таблица</div>
		</div>
		<div id="content">
			<div class="section" id="code">
				<div id="editor"></div>
			</div>
			<div class="section active" id="docs">
# Документация

### _bodjo/tanks_

## Правила игры
Каждому игроку дается возможность управлять танком случайного цвета (необязательно уникального) на игровом виртуальном поле. Танк умеет ездить (move), поворачивать "головой" (headAngle) и стрелять (shoot).

"Здоровье" танка - число от 0 до 1. Обычно урон одной пули 0.25, но если подобрать бонус элитной аммуниции, то урон возрастет до 0.5, т.е. полностью новый танк можно уничтожить за четыре обычных выстрела, или два бонусных. Единственная возможность пополнить здоровье - бонусы "аптечки", которые чинят танк на 0.5 в течении 10 секунд.

Чтобы подняться в таблице рекордов, необходимо набрать как можно больше очков. Очки даются за уничтожение танка противника. Первое уничтожение - +100 очков, следующее - +125 очков, смерть - счётчик сбрасывается и за следующее убийство дадут снова +100 очков. Говоря математическим языком, количество очков за уничтожение: 100 + 25 * combo, где _combo_ - номер итерации цикла, который сбрасывается после смерти танка, или смене кода.

## Код

### Входные данные

Ваша задача, в первую очередь - написать функцию `onTick()`. Она должна принимать один аргумент - данные игрового поля в виде объекта. Также в глобальном окружении вам даны четыре константы: **[number]** width, **[number]** height, **[number]** tankRadius и **[array]** walls. Ширина, высота и радиус танка - это количество условных единиц, не пикселей. walls - (стены; массив массивов с двумя точками стены)
Пример:

	[
		[{x: 7.5, y: 2.5}, {x: 2.5, y: 2.5}],
		[{x: 2.5, y: 2.5}, {x: 2.5, y: 7.5}],
		[{x: 2.5, y: 12.5}, {x: 2.5, y: 17.5}],
		[{x: 2.5, y: 17.5}, {x: 7.5, y: 17.5}]
	]

Заметьте, что указан tankRadius. На сервере танк - это окружность и все вычисления с танками выполняются, как вычисления с кругами. Это сделано для более простого поворота и просчета колизий, чтобы танк не застрял в стене, повернувшись мгновенно на Х градусов и не зацепил стену углом квадрата.

Далее идет перечисление всех ключей и значений, которые вы можете найти в данном аргументе. Не стоит бояться столь большого их количества, многое из этого вам может не понадобиться.

Вы также можете "пощупать" данные в консоли, введя `lastData` и получив последний ответ сервера.

* * * 

**[object]** data

- **[number]** time (номер "тика" - обновления поля)
- **[object]** me (данные о вашем танке)
    - **[number]** x (от 0 до width)
    - **[number]** y (от 0 до height)
    - **[number]** hp (здоровье, от 0 до 1)
    - **[string]** username (ваш юзернейм, вдруг вы забыли)
    - **[string]** color (цвет танка)
    - **[number]** lastShot (номер "тика", когда был последний выстрел; удобно понимать, когда можно стрелять, учитывая, что перезаряд танка - 15 "тиков")
    - **[object]** activeBonuses (активные бонусы)
    	- **[object]** heal (бонус "аптечка"; может отсутствовать в объекте, если бонуса нет)
    		- **[number]** start (номер "тика", когда был подобран бонус)
    		- **[number]** duration (количество "тиков", сколько бонус будет действовать)
    	- **[object]** ammo (бонус элитной аммуниции; может отсутствовать в объекте, если бонуса нет)
    		- **[number]** start (номер "тика", когда был подобран бонус)
    		- **[number]** duration (количество "тиков", сколько бонус будет действовать)
- **[array]** enemies (данные о вражеских танках)

	[{

	- **[number]** x (от 0 до width)
	- **[number]** y (от 0 до height)
	- **[number]** hp (здоровье, от 0 до 1)
	- **[number]** angle (поворот танка, в радианах)
	- **[number]** headAngle (поворот головы танка, в радианах)
	- **[string]** username (юзернейм владельца вражеского танка)
	- **[string]** color (цвет вражеского танка)
	- **[number]** lastShot (время, номер "тика" последнего выстрела)
    - **[object]** activeBonuses (активные бонусы; аналогично с me)

	},...]

- **[array]** bullets (данные про пули)

	[{

	- **[number]** x (от 0 до width)
	- **[number]** y (от 0 до height)
	- **[number]** vx (X-координата вектора полёта)
	- **[number]** vy (Y-координата вектора полёта)

	Чтобы предсказать, где будет пуля на следующем кадре, достаточно добавить к координатам вектор. Т.е. newX = x + vx; newY = y + vy.
	
	- **[number]** angle (угол полёта пули, в радианах)
	- **[string]** owner (юзернейм владельца пули)
	- **[string]** color (цвет пули)
	- **[boolean]** type (false - обычная, true - элитная)

	},...]

- **[array]** bonuses (не подобранные бонусы)
	
	[{

	- **[number]** x (от 0 до width)
	- **[number]** y (от 0 до height)
	- **[number]** radius (радиус, при котором бонус подберётся)
	- **[string]** type (тип бонуса, "heal" или "ammo")

	},...]

### Выходные данные

Ваша функция `onTick` должна возвращать объект с тремя ключами:

- **[number]** headAngle (угол поворота башни танка, в радианах)
- **[boolean]** shoot (стрелять ли (в направлении headAngle, который вы указали в этом объекте))
- **[array]** move (вектор движения танка)

	move - массив с двумя числами: X и Y координаты вектора движения. Ниже можно увидеть видео, где A - это вектор.

	Пример:
	
		[0.8660254, -0.499999]

	Максимальная скорость - 1, т.е. макс. длина вектора - 1.

	Чтобы поехать с максимальной скоростью по какому-то углу (например 90 градусов, или 0.5pi радиана), достаточно найти точку на окружности с радиусом 1. Подробнее, как найти точку на окружности можно посмотреть [тут](http://lmgtfy.com/?q=get+point+on+circle).

{VIDEO}

{WARN_START}**Будьте внимательны!**

Отсчет игрового поля начинается слева сверху (т.е. (0, 0) точка - слева сверху), поэтому на видео вы видите ось Y направленую вниз.
{WARN_END}

## Дополнительно

Можно делать дебаг прямо на игровом поле! Для этого есть четыре функции:

- `line(from, to, (optional) color)` Рисует линию.
- `point(your_point, (optional) color)` Рисует точку.
- `circle(center, radius, (optional) color)` Рисует окружность.
- `text(string, point, (optional) color)` Рисует текст.

Если не выбрать цвет, линия/точка будет нарисована красной.
Аргументы (кроме радиуса и цвета) должны быть объектами с ключами **x** и **y**. Все аргументы должны быть условными единицами и должны отталкиваться от констант width и height, поэтому можно легко функции указать себя (`data.me`) или пулю (`data.bullets[0]`) и прямо "с коробки". Например:

	line(me, enemy);
	line(bullet, me);

	circle(me, tankRadius);

	point({x: width/2, y: height/2});
	point(bullet);



Также, для удобства, все функции в **Math** можно писать без **Math.**. Например:

	sqrt(pow(a.x - b.x, 2) + pow(a.y - b.y, 2));
	point({x: width/2 + cos(PI/4)*10, y: height/2 + sin(PI/4)*10});
			</div>
			<script type="text/javascript" src="/lib/markdown.js"></script>
			<script type="text/javascript">
				var docs = document.querySelector("#docs");
				docs.innerHTML = toHTML(docs.innerHTML).replace(/{VIDEO}/g, "<video loop autoplay muted style='width:150px'><source src='explanation.mp4' type='video/mp4'></video>").replace(/\<a /g, "<a target='_blank' ").replace(/{WARN_START}/g,"<div class='warning'>").replace(/{WARN_END}/g,"</div>")
			</script>
			<div class='section' id='scoreboard'>
				<table>
					<tbody>
						<tr>
							<th>Место</th>
							<th>Никнейм</th>
							<th>Очки</th>
						</tr>
					</tbody>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
		<div id="control-panel">
			<div class='btn ripple' id="play">
			</div>
			<div class='btn ripple' id="pause">
			</div>
		</div>
	</div>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.3/ace.js"></script>
	<script type="text/javascript">
		const gameName = 'tanks';
		const defaultCode = '// constants: width, height, tankRadius\n// this function is runned every tick\n\nfunction onTick(data) {\n\n\treturn {\n\t\tmove: [0, 0],\n\t\theadAngle: Date.now()/1000*PI,\n\t\tshoot: true\n\t}\n}';
	</script>
	<script src="../ripple.js" type="text/javascript"></script>
	<script src="renderer.js" type="text/javascript"></script>
	<script src="logic.js" type="text/javascript"></script>
	<script src="../game-main.js" type="text/javascript"></script>
</body>
</html>